(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fb997592"],{2003:function(e,t,a){},2012:function(e,t,a){"use strict";var i=a("2003"),s=a.n(i);s.a},"697c":function(e,t,a){},8914:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.onTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"明细结算",name:"tab1"}},[a("detail-bill",{ref:"detailBill"})],1),a("el-tab-pane",{attrs:{label:"月汇总",name:"tab2"}},[a("month-summary",{on:{goto:e.goto}})],1)],1)],1)},s=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",[a("sc-expand-collapse",{on:{change:e.heightChange}},[a("div",{attrs:{slot:"collapse"},slot:"collapse"},[a("div",{staticClass:"search-box"},[a("sc-bill-code",{attrs:{onlyBill:!1,twoText:["单号","流水号"],resetType:e.resetBillCode},on:{typeChange:e.getType},model:{value:e.billCode,callback:function(t){e.billCode=t},expression:"billCode"}}),a("div",{staticClass:"ul-box"},[a("ul",{staticClass:"search-input-box"},[a("li",[a("div",{staticClass:"special-label"},[a("el-select",{ref:"timeSelect",staticClass:"time-select-input",model:{value:e.queryContent.dateType,callback:function(t){e.$set(e.queryContent,"dateType",t)},expression:"queryContent.dateType"}},[a("el-option",{key:0,attrs:{value:0,label:"中心结算时间"}}),a("el-option",{key:1,attrs:{value:1,label:"业务发生时间"}})],1)],1),a("div",{staticClass:"dateTimePicker"},[a("el-date-picker",{ref:"timePickerA",attrs:{type:"datetime",editable:!1,clearable:!1},on:{change:e.startDateChange},model:{value:e.queryContent.startScanDate,callback:function(t){e.$set(e.queryContent,"startScanDate",t)},expression:"queryContent.startScanDate"}}),e._v("\n                至\n                "),a("el-date-picker",{ref:"timePickerB",attrs:{type:"datetime",editable:!1,clearable:!1},model:{value:e.queryContent.endScanDate,callback:function(t){e.$set(e.queryContent,"endScanDate",t)},expression:"queryContent.endScanDate"}})],1)]),a("li",[a("span",{staticClass:"label"},[e._v("费用类型")]),a("el-select",{ref:"feeType",staticClass:"short-input",attrs:{placeholder:""},model:{value:e.queryContent.fineType,callback:function(t){e.$set(e.queryContent,"fineType",t)},expression:"queryContent.fineType"}},e._l(e.feeType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),a("li",[a("span",{staticClass:"label"},[e._v("账单类型")]),a("el-select",{ref:"billType",staticClass:"short-input",attrs:{placeholder:""},model:{value:e.queryContent.settlementType,callback:function(t){e.$set(e.queryContent,"settlementType",t)},expression:"queryContent.settlementType"}},e._l(e.billType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1)]),a("ul",{staticClass:"search-input-box"},[a("li",[a("span",{staticClass:"special-label"},[e._v("结算对象")]),a("sc-users",{ref:"refSettlement",staticClass:"short-input",attrs:{type:"7",placeholder:"",param:e.settleParam},on:{change:e.settlementChange},model:{value:e.queryContent.accountUserId,callback:function(t){e.$set(e.queryContent,"accountUserId",t)},expression:"queryContent.accountUserId"}})],1),a("li",[a("span",{staticClass:"label",staticStyle:{width:"89px"}},[e._v("业务员")]),a("sc-users",{ref:"refUser",staticClass:"short-input",attrs:{placeholder:"",type:"2"},model:{value:e.queryContent.recManId,callback:function(t){e.$set(e.queryContent,"recManId",t)},expression:"queryContent.recManId"}})],1),a("li",[a("span",{staticClass:"label"},[e._v("客户")]),a("sc-users",{ref:"refCustomer",staticClass:"short-input",attrs:{placeholder:"",type:"3"},model:{value:e.queryContent.customerId,callback:function(t){e.$set(e.queryContent,"customerId",t)},expression:"queryContent.customerId"}})],1),a("li",[a("span",{staticClass:"label"},[e._v("运单发放")]),a("sc-users",{ref:"refUserOrCustomer",staticClass:"short-input",attrs:{placeholder:"",type:"4"},model:{value:e.queryContent.salesManId,callback:function(t){e.$set(e.queryContent,"salesManId",t)},expression:"queryContent.salesManId"}})],1)]),a("ul",{staticClass:"search-input-box"},[a("li",[a("span",{staticClass:"special-label"},[e._v("扣款状态")]),a("el-select",{ref:"deductStatus",staticClass:"short-input",attrs:{placeholder:""},model:{value:e.queryContent.deductStatus,callback:function(t){e.$set(e.queryContent,"deductStatus",t)},expression:"queryContent.deductStatus"}},e._l(e.deductStatus,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),a("li",[a("span",{staticClass:"label",staticStyle:{width:"89px"}},[e._v("扣款人")]),a("sc-users",{ref:"refDeduct",staticClass:"short-input",attrs:{placeholder:"",type:"2"},model:{value:e.queryContent.deductOperatorId,callback:function(t){e.$set(e.queryContent,"deductOperatorId",t)},expression:"queryContent.deductOperatorId"}})],1)])]),a("div",{staticClass:"search-btn-box"},[a("el-button",{attrs:{type:"danger",icon:"el-icon-refresh"},on:{click:e.resetQueryContent}},[e._v("重置")]),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSearch}},[e._v("查询")])],1)],1)])]),a("div",{staticClass:"content-box"},[a("div",{staticClass:"btn-box"},[a("div",[e.z_method.showBtn("btn_rtiFee_deduct")?a("el-button",{attrs:{type:"danger",disabled:0===e.currentRow.length},on:{click:function(t){return e.openDeduct("批量扣款",1)}}},[e._v("\n          扣款\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_underLineDeduct")?a("el-button",{attrs:{type:"danger",disabled:0===e.currentRow.length},on:{click:function(t){return e.openDeduct("批量线下收款",2)}}},[e._v("\n          线下收款\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_cancelDeduct")?a("el-button",{attrs:{type:"danger",disabled:0===e.currentRow.length},on:{click:e.batchUpdate}},[e._v("\n          取消扣款\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_editUser")?a("el-button",{attrs:{type:"success",disabled:0===e.currentRow.length},on:{click:e.openEdit}},[e._v("\n          编辑\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_sendSettlement")?a("el-button",{attrs:{type:"success",disabled:0===e.currentRow.length},on:{click:e.batchUpdate}},[e._v("\n          同步寄件结算对象\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_paiSettlement")?a("el-button",{attrs:{type:"success",disabled:0===e.currentRow.length},on:{click:e.batchUpdate}},[e._v("\n          同步派件结算对象\n        ")]):e._e(),e.z_method.showBtn("btn_rtiFee_userOrCustomer")?a("el-button",{attrs:{type:"success",disabled:0===e.currentRow.length},on:{click:e.batchUpdate}},[e._v("\n          同步运单发放\n        ")]):e._e()],1),a("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.exportNew}},[e._v("导出")])],1),a("div",{style:{height:e.contentHeight+"px"},on:{click:e.onClickTable}},[a("Spread",{attrs:{"ng-data":e.tableData,headData:e.tableHead},on:{checkboxAllClick:e.checkboxAllClick}})],1),a("div",{staticClass:"page-box"},[a("sz-pagination",{attrs:{page:e.pagination.currentPage,pageSize:e.pagination.pageSize,total:e.pagination.total},on:{fetchData:e.fetchData}})],1)]),a("csv",{attrs:{visible:e.exportObj.visible,fileName:e.exportObj.fileName,head:e.tableHead,paramData:e.exportObj.excelData,sum:e.exportObj.sum,current:e.exportObj.current},on:{clear:e.closeDialog}}),a("async-export",{ref:"asyncExport",attrs:{exportData:e.tableHead.columns,exportName:e.exportObj.fileName,exportUrl:e.exportUrl,exportOption:e.optionsClone}}),a("sz-batch-process",{attrs:{title:e.batchTitle,dialogVisible:e.batchDialogVisible,columns:e.columns,tableData:e.batchRow,batchUrl:e.batchUrl,"data-validate":e.dataValidate},on:{model:e.close}}),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{title:e.deductForm.deductFeeType>1?"单个线下收款":"单个扣款",width:"400px","close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.deductDialogVisible},on:{"update:visible":function(t){e.deductDialogVisible=t}}},[a("div",{staticClass:"form-box"},[a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("结算编号/单号：")]),a("el-input",{staticClass:"form-input",attrs:{disabled:!0},model:{value:e.deductForm.fineCode,callback:function(t){e.$set(e.deductForm,"fineCode",t)},expression:"deductForm.fineCode"}})],1),a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("结算对象：")]),a("el-input",{staticClass:"form-input",attrs:{disabled:!0},model:{value:e.deductForm.accountUserName,callback:function(t){e.$set(e.deductForm,"accountUserName",t)},expression:"deductForm.accountUserName"}})],1),a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("金额：")]),a("el-input",{staticClass:"form-input",attrs:{disabled:!0},model:{value:e.deductForm.fineFee,callback:function(t){e.$set(e.deductForm,"fineFee",t)},expression:"deductForm.fineFee"}})],1),a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("扣款金额：")]),a("el-input",{staticClass:"form-input",model:{value:e.deductForm.deductFee,callback:function(t){e.$set(e.deductForm,"deductFee",t)},expression:"deductForm.deductFee"}})],1),a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("备注：")]),a("el-input",{staticClass:"form-input",attrs:{type:"textarea",rows:3,resize:"none",maxlength:"30",placeholder:"最多输入30个字!"},model:{value:e.deductForm.remark,callback:function(t){e.$set(e.deductForm,"remark",t)},expression:"deductForm.remark"}})],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deductDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.singleDeduct()}}},[e._v("确 定")])],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{title:"编辑",width:"400px","modal-append-to-body":!1,"close-on-click-modal":!1,visible:e.editDialogVisible},on:{"update:visible":function(t){e.editDialogVisible=t}}},[a("div",{staticClass:"form-box"},[a("div",{staticClass:"form-box-item"},[a("span",{staticClass:"form-title"},[e._v("关联业务员：")]),a("sc-users",{ref:"editUsers",staticClass:"form-input",attrs:{placeholder:"",type:"2","popper-class":"max-index"},model:{value:e.editUserId,callback:function(t){e.editUserId=t},expression:"editUserId"}})],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmEdit}},[e._v("确 定")])],1)])],1)},r=[],o=(a("2b45"),a("ed63"),a("8cf2"),a("9a33"),a("163d"),a("ac0d")),l=a("391c"),c=a("6bf2"),d=a.n(c),u=a("a3be"),h=a("4055"),p={name:"detailBill",mixins:[o["b"]],activated:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},mounted:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},data:function(){var e=this;return{height:342,billCode:"",codeType:!0,resetBillCode:0,feeType:[{label:"全部",id:-1},{label:"退件费",id:1},{label:"转账费",id:2},{label:"拦截费",id:0}],billType:[{label:"全部",id:-3},{label:"业务员",id:4},{label:"承包区",id:2},{label:"客户",id:0},{label:"无对象",id:-1},{label:"下级网点",id:99}],deductStatus:[{label:"全部",id:-1},{label:"未扣款",id:0},{label:"已线上扣款",id:1},{label:"已线下收款",id:2}],queryContent:{startScanDate:new Date(d()().subtract(1,"days").format("YYYY-MM-DD")+" 00:00:00"),endScanDate:new Date(d()().subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59"),fineWater:"",fineCode:"",recManId:"",fineType:-1,settlementType:-3,deductOperatorId:"",deductStatus:-1,dateType:0,accountUserId:"",accountUserType:"",customerId:"",salesManId:"",preSiteId:""},optionsClone:{},tableHead:{rowStyle:function(e){if(1===Number(e.deductStatus)||2===Number(e.deductStatus))return{foreColor:"green"}},columns:[{displayName:"选择",checked:!0,name:"check",allCheck:!0,isBillCode:!0,cellType:new GC.Spread.Sheets.CellTypes.CheckBox,isHideFilter:!1,iShow:!1,size:50,isEdit:!0,isCheckBox:!0,onchange:function(t,a){e.selectionSite(t,a)},dblclick:function(t){e.selectionSite()}},{displayName:"结算编号/单号",name:"fineCode",size:150,isCode:!0,dblclick:function(t){window.open(e.z_param.billsUrl+t)}},{displayName:"结算流水号",name:"fineWater",isCode:!0,size:150},{displayName:"中心结算时间",name:"fineDate",size:150,formatter:"yyyy-MM-dd hh:mm:ss"},{displayName:"业务发生时间",name:"scanDate",size:150,formatter:"yyyy-MM-dd hh:mm:ss"},{displayName:"费用类型",name:"fineType",value:function(e){var t=e["fineType"];return 1===t?"退件费":2===t?"转账费":0===t?"拦截费":""}},{displayName:"账单类型",name:"settlementType",value:function(e){var t=e["settlementType"];return-1===t?"无对象":0===t?"客户":2===t?"承包区":4===t?"业务员":99===t?"下级网点":""}},{displayName:"客户",name:"customerName"},{displayName:"客户编码",name:"customerCode",isCode:!0},{displayName:"业务员",name:"recManName"},{displayName:"业务员工号",name:"recManCode",isCode:!0},{displayName:"结算对象",name:"accountUserName"},{displayName:"结算对象编码",name:"accountUserCode",isCode:!0},{displayName:"金额",name:"fineFee",showTotal:!0},{displayName:"扣款金额",name:"deductFee",showTotal:!0},{displayName:"扣款状态",name:"deductStatus",value:function(e){return 0===e.deductStatus?"未扣款":1===e.deductStatus?"已线上扣款":2===e.deductStatus?"已线下收款":void 0}},{displayName:"扣款人",name:"deductOperator"},{displayName:"扣款时间",name:"deductDate",size:150,formatter:"yyyy-MM-dd hh:mm:ss"},{displayName:"运单发放",name:"salesManName"},{displayName:"备注",name:"remark",size:400,isConversionComma:!0}]},tableData:[],currentRow:[],batchRow:[],batchTitle:"",batchUrl:"",batchDialogVisible:!1,columns:[],exportObj:{fileName:"收退件转账拦截费-明细结算"},exportUrl:u["qc"],deductDialogVisible:!1,deductForm:{fineCode:"",accountUserName:"",fineFee:"",deductFee:"",remark:"",fineType:"",settlementType:"",id:"",deductFeeType:0,isBatch:0},editUserId:"",editDialogVisible:!1,settleParam:{types:""}}},methods:{summaryToDetail:function(e){var t=this;this.resetQueryContent(),this.queryContent.startScanDate=d()(e.accountDate).format("YYYY-MM")+"-01 00:00:00",this.queryContent.endScanDate=d()(new Date(d()(e.accountDate).add(1,"M").format("YYYY-MM-DD HH:mm:ss")).getTime()-1e3).format("YYYY-MM-DD HH:mm:ss"),this.queryContent.fineType=e.fineType,this.queryContent.settlementType=e.settlementType,this.queryContent.accountUserType=e.settlementType,99===e.settlementType?this.settleParam.types="99":this.settleParam.types="0,2,4",setTimeout((function(){t.queryContent.accountUserId=e.accountUserId,t.onSearch()}),0)},settlementChange:function(e){this.queryContent.accountUserType=null!==e?e.type:""},startDateChange:function(e){e&&this.$refs.timePickerB.focus()},onSearch:function(){if(Object(l["trim"])(this.billCode)){var e=Object(l["trim"])(this.billCode).split(/[,\r\n]/);if(e.length>1e3){var t="最多支持1000个"+(this.codeType?"单":"流水")+"号查询";return void this.msg(t)}this.codeType?(this.queryContent.fineCode=e.join(","),this.queryContent.fineWater=""):(this.queryContent.fineWater=e.join(","),this.queryContent.fineCode="")}else{if(this.queryContent.fineWater="",this.queryContent.fineCode="",!this.queryContent.startScanDate&&!this.queryContent.endScanDate)return void this.msg("查询时间不能为空");if(this.queryContent.startScanDate||this.queryContent.endScanDate){if(this.timeCheck(this.queryContent.startScanDate,this.queryContent.endScanDate,0===this.queryContent.dateType?"结算时间":"业务发生时间"))return;this.queryContent.startScanDate=d()(this.queryContent.startScanDate).format("YYYY-MM-DD HH:mm:ss"),this.queryContent.endScanDate=d()(this.queryContent.endScanDate).format("YYYY-MM-DD HH:mm:ss")}}this.pagination.currentPage=1,this.queryContent.pageSize=this.pagination.pageSize,this.queryContent.currentPage=this.pagination.currentPage,this.query(this.queryContent)},query:function(e){var t=this;e&&(this.optionsClone=Object(l["cloneDeep"])(e)),Object(u["pc"])(this.optionsClone).then((function(e){t.settleParam.types="",0===e.code&&e.data.list&&e.data.list.length>0?(t.tableData=e.data.list,t.tableData.map((function(e){0===e.deductStatus&&(e.deductOperator="",e.deductDate="")})),t.optionsClone.fineWater||t.optionsClone.fineCode?t.pagination.total=0:t.pagination.total=e.data.totalRow):0===e.code?(t.msg("暂无数据！"),t.pagination.total=0,t.tableData=[]):(t.pagination.total=0,t.tableData=[])})).catch((function(e){t.settleParam.types="",t.pagination.total=0,t.tableData=[]}))},exportNew:function(){if(this.optionsClone.fineWater||this.optionsClone.fineCode)this.tableData.length>0?(this.checklistData=this.tableData,this.checklistExport()):this.msg("没有数据无法导出!");else{if(this.pagination.total>8e5)return void this.msg("最大导出不能超过80万");this.pagination.total>this.pagination.pageSize?this.$refs.asyncExport.export():(this.checklistData=this.tableData,this.checklistExport())}},heightChange:function(e){var t=this;this.height=e?342:220,this.$nextTick((function(){t.z_method.refreshSpread()}))},resetQueryContent:function(){this.billCode="",this.resetBillCode++,this.codeType=!0,this.queryContent={startScanDate:new Date(d()().subtract(1,"days").format("YYYY-MM-DD")+" 00:00:00"),endScanDate:new Date(d()().subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59"),fineWater:"",fineCode:"",recManId:"",fineType:-1,settlementType:-3,deductOperatorId:"",deductStatus:-1,dateType:0,accountUserId:"",accountUserType:"",customerId:"",salesManId:"",preSiteId:""},this.$refs.refSettlement.clear(),this.$refs.refUser.clear(),this.$refs.refCustomer.clear(),this.$refs.refDeduct.clear(),this.$refs.refUserOrCustomer.clear()},onClickTable:function(){this.$refs.refSettlement.autoBlur(),this.$refs.refUser.autoBlur(),this.$refs.refCustomer.autoBlur(),this.$refs.refDeduct.autoBlur(),this.$refs.refUserOrCustomer.autoBlur(),this.$refs.timePickerA._data.pickerVisible=!1,this.$refs.timePickerB._data.pickerVisible=!1,this.$refs.timeSelect.visible&&(this.$refs.timeSelect.visible=!1),this.$refs.feeType.visible&&(this.$refs.feeType.visible=!1),this.$refs.billType.visible&&(this.$refs.billType.visible=!1),this.$refs.deductStatus.visible&&(this.$refs.deductStatus.visible=!1)},getType:function(e){this.codeType=e},timeCheck:function(e,t,a){if(!e||!t)return this.msg("请选择完整的"+a+"时间段"),!0;if(d()(e).isAfter(t))return this.msg(a+"开始时间不能大于结束时间"),!0;var i=d()(t).subtract(31,"days"),s=d()(i).isAfter(d()(e));return!!s&&(this.msg(a+"相差不能大于31天"),!0)},checkboxAllClick:function(e){this.selectionSite([],e)},selectionSite:function(e,t){this.currentRow=this.tableData.filter((function(e){return!0===e.check}))},openDeduct:function(e,t){1===this.currentRow.length?(this.deductForm={fineCode:this.currentRow[0].fineCode,accountUserName:this.currentRow[0].accountUserName,fineFee:this.currentRow[0].fineFee,deductFee:Object(l["cloneDeep"])(this.currentRow[0].fineFee),remark:Object(l["cloneDeep"])(this.currentRow[0].remark),fineType:this.currentRow[0].fineType,settlementType:this.currentRow[0].settlementType,id:this.currentRow[0].id,deductFeeType:t,isBatch:0},this.deductDialogVisible=!0):this.currentRow.length>1&&(this.batchTitle=e,this.deductForm.deductFeeType=t,this.batchUpdateAjax())},checkNum:function(e){var t=!1;if(e.toString().includes(".")){var a=e.toString().split("."),i=a[1].length;i>2&&(t=!0)}return t},singleDeduct:function(){0===this.deductForm.deductFee||"0"===this.deductForm.deductFee||""!==this.deductForm.deductFee&&this.deductForm.deductFee?0!=this.deductForm.deductFee?/^\d+(\.\d+)?$/.test(this.deductForm.deductFee)?this.checkNum(this.deductForm.deductFee)?this.msg("扣款金额小数点只能保留2位小数!"):Number(this.deductForm.deductFee)<0||Number(this.deductForm.deductFee)>9999999?this.msg("扣款金额的范围是0~9999999"):!this.deductForm.remark||h["billUtils"].regRemark(this.deductForm.remark)?this.deductForm.deductFeeType<2?this.deductAjax():this.underlineDeductAjax():this.msg("只能输入数字或字母或中文或常见符号!"):this.msg("请输入有效数字且最多能输入两位小数！"):this.msg("扣款金额不能为0!"):this.msg("扣款金额不能为空!")},deductAjax:function(){var e=this;Object(u["oc"])(this.deductForm).then((function(t){0===t.code&&(e.$message({message:"操作成功!",type:"success"}),e.query(),e.deductDialogVisible=!1,e.deductForm={fineCode:"",accountUserName:"",fineFee:"",deductFee:"",remark:"",fineType:"",settlementType:"",id:"",deductFeeType:"",isBatch:0})}))},underlineDeductAjax:function(){var e=this;Object(u["tc"])(this.deductForm).then((function(t){0===t.code&&(e.$message({message:"操作成功!",type:"success"}),e.query(),e.deductDialogVisible=!1,e.deductForm={fineCode:"",accountUserName:"",fineFee:"",deductFee:"",remark:"",fineType:"",settlementType:"",id:"",deductFeeType:"",isBatch:0})}))},openEdit:function(){this.editUserId="",this.currentRow.length>0&&(this.$refs.editUsers&&this.$refs.editUsers.clear(),this.editDialogVisible=!0)},confirmEdit:function(){this.editUserId?(this.editDialogVisible=!1,this.batchTitle="编辑",this.batchUpdateAjax()):this.msg("请选择业务员!")},batchUpdate:function(e){0!==this.currentRow.length?(this.batchTitle=e.target.innerText,this.batchUpdateAjax()):this.msg("请选择要操作的数据!")},batchUpdateAjax:function(){var e=this;"批量扣款"===this.batchTitle||"批量线下收款"===this.batchTitle?("批量扣款"===this.batchTitle?this.batchUrl="/bills/financeFeeBill/deductMoney":"批量线下收款"===this.batchTitle&&(this.batchUrl="/bills/financeFeeBill/underLineDeductMoney"),this.batchRow=this.currentRow.map((function(t){return{id:t.id,fineCode:t.fineCode,fineType:t.fineType,settlementType:t.settlementType,deductFee:t.fineFee,deductFeeType:e.deductForm.deductFeeType,remark:t.remark,isBatch:1,accountUserName:t.accountUserName}}))):"取消扣款"===this.batchTitle?(this.batchUrl="/bills/financeFeeBill/deductMoney",this.batchRow=this.currentRow.map((function(e){return{id:e.id,fineCode:e.fineCode,fineType:e.fineType,settlementType:e.settlementType,deductFeeType:0,isBatch:1}}))):"编辑"===this.batchTitle?this.batchRow=this.currentRow.map((function(t){return{id:t.id,fineCode:t.fineCode,userId:e.editUserId,settlementType:t.settlementType}})):this.batchRow=this.currentRow.map((function(e){return{id:e.id,fineCode:e.fineCode,settlementType:e.settlementType}})),"编辑"===this.batchTitle?this.batchUrl="/bills/financeFeeBill/updateRecUserId":"同步寄件结算对象"===this.batchTitle?this.batchUrl="/bills/financeFeeBill/syncRecUserId":"同步派件结算对象"===this.batchTitle?this.batchUrl="/bills/financeFeeBill/syncPaiUserId":"同步运单发放"===this.batchTitle&&(this.batchUrl="/bills/financeFeeBill/syncBillSendUserId"),"批量扣款"===this.batchTitle||"批量线下收款"===this.batchTitle?this.columns=[{displayName:"结算编号/单号",name:"fineCode",size:100},{displayName:"结算对象",name:"accountUserName",size:100},{displayName:"扣款金额",name:"deductFee",size:50}]:this.columns=[{displayName:"结算编号/单号",name:"fineCode",size:100}],this.batchDialogVisible=!0},dataValidate:function(e){return new Promise((function(t,a){99!==e.settlementType?t(e):a("失败，不可处理下级账单!")}))},close:function(e){this.batchDialogVisible=!1,this.batchRow=[],"noSearch"!==e&&(this.currentRow=[],this.query())}},computed:{contentHeight:function(){return this.z_param.isActiveH?this.$store.getters.clientHeight-this.height+60:this.z_param.isNode?this.$store.getters.clientHeight-this.height:this.$store.getters.clientHeight-this.height+60}}},m=p,b=(a("2012"),a("623f")),f=Object(b["a"])(m,n,r,!1,null,"a0a13f86",null),y=f.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",[a("sc-expand-collapse",{on:{change:e.heightChange}},[a("div",{attrs:{slot:"collapse"},slot:"collapse"},[a("div",{staticClass:"search-box"},[a("ul",{staticClass:"search-input-box"},[a("li",[a("span",{staticClass:"label"},[e._v("中心结算月份")]),a("div",{staticClass:"datePicker"},[a("el-date-picker",{ref:"timePicker",attrs:{editable:!1,clearable:!1,type:"month"},model:{value:e.queryContent.accountDate,callback:function(t){e.$set(e.queryContent,"accountDate",t)},expression:"queryContent.accountDate"}})],1)]),a("li",[a("span",{staticClass:"label"},[e._v("费用类型")]),a("el-select",{ref:"feeType",staticClass:"short-select",attrs:{placeholder:""},model:{value:e.queryContent.fineType,callback:function(t){e.$set(e.queryContent,"fineType",t)},expression:"queryContent.fineType"}},e._l(e.feeType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),a("li",[a("span",{staticClass:"label"},[e._v("账单类型")]),a("el-select",{ref:"billType",staticClass:"short-select",attrs:{placeholder:""},model:{value:e.queryContent.settlementType,callback:function(t){e.$set(e.queryContent,"settlementType",t)},expression:"queryContent.settlementType"}},e._l(e.billType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),a("li",[a("span",{staticClass:"label"},[e._v("结算对象")]),a("sc-users",{ref:"refSettlement",staticClass:"short-input",attrs:{type:"7",placeholder:""},on:{change:e.settlementChange},model:{value:e.queryContent.accountUserId,callback:function(t){e.$set(e.queryContent,"accountUserId",t)},expression:"queryContent.accountUserId"}})],1)]),a("div",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSearch}},[e._v("查询")])],1)])])]),a("div",{staticClass:"content-box"},[a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.exportNew}},[e._v("导出")])],1),a("div",{style:{height:e.contentHeight+"px"},on:{click:e.onClickTable}},[a("Spread",{attrs:{"ng-data":e.tableData,"head-data":e.tableHead}})],1),a("div",{staticClass:"page-box"},[a("sz-pagination",{attrs:{page:e.pagination.currentPage,pageSize:e.pagination.pageSize,total:e.pagination.total},on:{fetchData:e.fetchData}})],1)]),a("csv",{attrs:{visible:e.exportObj.visible,fileName:e.exportObj.fileName,head:e.tableHead,paramData:e.exportObj.excelData,sum:e.exportObj.sum,current:e.exportObj.current},on:{clear:e.closeDialog}})],1)},C=[],v={name:"monthSummary",mixins:[o["b"]],activated:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},mounted:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},data:function(){return{height:260,feeType:[{label:"全部",id:-1},{label:"退件费",id:1},{label:"转账费",id:2},{label:"拦截费",id:0}],billType:[{label:"全部",id:-3},{label:"业务员",id:4},{label:"承包区",id:2},{label:"客户",id:0},{label:"无对象",id:-1},{label:"下级网点",id:99}],queryContent:{accountDate:new Date,fineType:-1,settlementType:-3,accountUserId:"",accountUserType:"",preSiteId:""},optionsClone:{},tableData:[],tableHead:{dblclick:this.dblclick,columns:[{displayName:"中心结算月份",name:"accountDate",formatter:"yyyy-MM",isCode:!0},{displayName:"费用类型",name:"fineType",value:function(e){var t=e["fineType"];return 1===t?"退件费":2===t?"转账费":0===t?"拦截费":""}},{displayName:"金额",name:"fineFee",showTotal:!0},{displayName:"结算对象",name:"accountUserName"},{displayName:"结算对象编码",name:"accountUserCode",isCode:!0},{displayName:"账单类型",name:"settlementType",value:function(e){var t=e["settlementType"];return-1===t?"无对象":0===t?"客户":2===t?"承包区":4===t?"业务员":99===t?"下级网点":""}},{displayName:"应扣总金额",name:"deductFee",showTotal:!0},{displayName:"已扣款金额",name:"deductedFee",showTotal:!0},{displayName:"未扣款金额",name:"notDeductFee",showTotal:!0}]},exportObj:{fileName:"收退件转账拦截费-月汇总"},requestUrl:u["sc"]}},methods:{dblclick:function(e,t,a){this.$emit("goto","tab1",t)},onSearch:function(){this.queryContent.accountDate?(this.queryContent.accountDate=d()(this.queryContent.accountDate).format("YYYY-MM"),this.pagination.currentPage=1,this.queryContent.pageSize=this.pagination.pageSize,this.queryContent.currentPage=this.pagination.currentPage,this.query(this.queryContent)):this.msg("中心结算月份不能为空")},query:function(e){var t=this;e&&(this.optionsClone=Object(l["cloneDeep"])(e)),Object(u["rc"])(this.optionsClone).then((function(e){0===e.code&&e.data.list&&e.data.list.length>0?(t.pagination.total=e.data.totalRow,t.tableData=e.data.list):0===e.code?(t.msg("暂无数据！"),t.pagination.total=0,t.tableData=[]):(t.pagination.total=0,t.tableData=[])})).catch((function(e){t.pagination.total=0,t.tableData=[]}))},settlementChange:function(e){this.queryContent.accountUserType=null!==e?e.type:""},exportNew:function(){this.searchExport()},onClickTable:function(){this.$refs.timePicker._data.pickerVisible=!1,this.$refs.feeType.visible&&(this.$refs.feeType.visible=!1),this.$refs.billType.visible&&(this.$refs.billType.visible=!1),this.$refs.refSettlement.autoBlur()},heightChange:function(e){var t=this;this.height=e?260:220,this.$nextTick((function(){t.z_method.refreshSpread()}))}},computed:{contentHeight:function(){return this.z_param.isActiveH?this.$store.getters.clientHeight-this.height+60:this.z_param.isNode?this.$store.getters.clientHeight-this.height:this.$store.getters.clientHeight-this.height+60}}},D=v,x=(a("9dbd"),Object(b["a"])(D,g,C,!1,null,"647c5f15",null)),T=x.exports,k={name:"returnTransferInterceptFee",components:{detailBill:y,monthSummary:T},data:function(){return{activeName:"tab1"}},methods:{onTabClick:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},goto:function(e,t){this.activeName=e,this.z_method.refreshSpread(),this.$refs.detailBill.summaryToDetail(t)}}},S=k,q=Object(b["a"])(S,i,s,!1,null,"c887e4bc",null);t["default"]=q.exports},"9dbd":function(e,t,a){"use strict";var i=a("697c"),s=a.n(i);s.a},ac0d:function(e,t,a){"use strict";a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return u}));a("5ab2"),a("6d57"),a("e10e");var i=a("ac9f"),s=a("a2e5"),n=a("391c"),r=a("6bf2"),o=a.n(r);function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={activated:function(){var e=this;this.$nextTick((function(){e.z_method.refreshSpread()}))},data:function(){return{pagination:{currentPage:1,total:0,pageSize:100},optionsClone:{},options:{},btnDisabled:!1,exportObj:{visible:!1,sum:1,current:0,fileName:"导出文件名",excelData:[]},requestMode:"post",requestUrl:"/",requestPageSize:5e3,checklistData:[],isLayering:!1,isQs:!0,billsCode:"",sbc:""}},mounted:function(){},methods:{query:function(){console.log("000000")},fetchData:function(e){this.pagination=c({},this.pagination,{pageSize:e.pageSize?e.pageSize:this.pagination.pageSize,currentPage:e.page?e.page:1});var t={};"{}"!=JSON.stringify(this.optionsClone)?(t=this.isLayering?c({},this.optionsClone,{pageParam:{pageSize:this.pagination.pageSize,currentPage:this.pagination.currentPage}}):c({},this.optionsClone,{pageSize:this.pagination.pageSize,currentPage:this.pagination.currentPage}),this.query(t)):this.msg("请先查询")},exportCsv:function(e){e.exportObj.visible=!0},closeDialog:function(e){this.exportObj.visible=e,this.exportObj.current=1},searchExport:function(){if(this.btnDisabled=!0,0===this.tableData.length)return this.msg("没有数据无法导出！"),void(this.btnDisabled=!1);var e=Object(n["cloneDeep"])(this.optionsClone);if(this.pagination.total>2e5)return this.msg("导出失败，本次数据超过20W条，请分批导出！"),void(this.btnDisabled=!1);var t=Math.ceil(this.pagination.total/this.requestPageSize);this.exportObj.sum=t,this.exportObj.current=0,this.exportSync(0,t,e,this.requestUrl)},exportSync:function(e,t,a,i){e!=t?(++e,this.isLayering?(a.pageParam.pageSize=this.requestPageSize,a.pageParam.currentPage=e):(a.pageSize=this.requestPageSize,a.currentPage=e),"post"==this.requestMode?this.exportPost(t,e,a,i):this.exportGet(t,e,a,i)):this.btnDisabled=!1},exportPost:function(e,t,a,i){var n=this;this.isQs?Object(s["d"])(i,a,this.isQs).then((function(s){n.exportNormal(s,e,t,a,i)})).catch((function(t){n.exportError(e)})):Object(s["e"])(i,a).then((function(s){n.exportNormal(s,e,t,a,i)})).catch((function(t){n.exportError(e)}))},exportGet:function(e,t,a,i){var n=this;Object(s["c"])(i,a,this.isQs).then((function(s){n.exportNormal(s,e,t,a,i)})).catch((function(t){n.exportError(e)}))},exportNormal:function(e,t,a,i,s){0!=e.code&&(e.data.list=[]),"sendMailFeeOrPayFeeDetail"===this.sbc&&(e.data.list=this.calculation(e.data.list)),"sendReceiveFeeSummary"===this.sbc&&(e.data.list=this.ischeckrow(e.data.list)),this.exportObj=c({},this.exportObj,{sum:t,current:a,excelData:e.data.list}),this.exportCsv(this),this.exportSync(a,t,i,s)},exportError:function(e){this.btnDisabled=!1,this.msg("网络出错，导出部分数据"),this.exportObj=c({},this.exportObj,{sum:e,current:e}),this.exportObj.excelData=[],this.exportCsv(this)},checklistExport:function(){return this.btnDisabled=!0,""==this.checklistData?(this.msg("没有数据无法导出"),void(this.btnDisabled=!1)):this.checklistData.length>1e5?(this.msg("数据量太大，请优化查询条件"),void(this.btnDisabled=!1)):(this.exportObj=c({},this.exportObj,{sum:1,current:1,excelData:this.checklistData}),this.exportCsv(this),void(this.btnDisabled=!1))},clearBtnDisabled:function(){this.btnDisabled=!1},msg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";this.$message({showClose:!0,message:e,type:t,duration:3e3})},formatterFunc:function(e,t){var a=e.filter((function(e){return e.value===t}));return a.length>0?a[0].label:"-"}}},u={data:function(){return{btnDisabled:!1,exportObj:{visible:!1,sum:1,current:0,fileName:"导出文件名",excelData:[]}}},methods:{exportBasicUtils:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this.btnDisabled=!0,setTimeout((function(){t.btnDisabled=!1}),3e3);var i=e.totalRow,s=e.isBillCode,n=e.checklistData,r=e.fileName,o=e.type;if(this.exportObj.fileName=r,i)if(i>2e5)this.msg("您查询到的数据量过大（最多20万条），请细化查询条件后再进行导出");else if(s||n&&n.length>=i)n.length>0?this.exportObj={fileName:r,sum:1,current:1,excelData:n,visible:!0}:this.msg("暂无数据，无法导出");else if("day"==o)this.exportObj={excelData:[],fileName:r,sum:i,current:1},this.finished(e,e.paramIn,0);else{var l=Math.ceil(i/a);this.exportObj={excelData:[],fileName:r,sum:l,current:0},this.exportByPage(0,l,e,a)}else this.msg("暂无数据，无法导出")},exportByPage:function(e,t,a,i){var n=this;if(e!=t){var r=a.methodType,o=a.url,l=a.paramIn;++e;var d=c({},l,{pageSize:i,currentPage:e});Object(s["a"])(r,o,d,!0,!1).then((function(s){return n.exportObj=c({},n.exportObj,{sum:t,current:e,excelData:s.data.list,visible:!0}),n.exportByPage(e,t,a,i)})).catch((function(e){n.msg("网络出错，导出部分数据"),n.exportObj=c({},n.exportObj,{sum:t,current:t,excelData:[],visible:!0})}))}},callback:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e.methodType,r=e.url,o=e.totalRow;Object(s["a"])(n,r,t,!0,!1).then((function(s){i+=s.data.list.length,s.data.currentPage>=s.data.totalPage?a.finished(e,t,i):(t.currentPage=s.data.currentPage,t.currentPage=t.currentPage+1,a.callback(e,t,i)),a.exportObj=c({},a.exportObj,{sum:o,current:i,excelData:s.data.list,visible:!0})})).catch((function(e){a.msg("网络出错，导出部分数据"),a.exportObj=c({},a.exportObj,{sum:o,current:o,excelData:[],visible:!0})}))},finished:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=e.startDateKey,r=e.endDateKey,o=e.totalRow,l=e.fileName,d=e.allEndDate,u=e.queryInternal,h=u||0;h=h>0?h-1:0;var p=new Date(d).getTime(),m=new Date(t[r]).getTime();p==m&&p>new Date(t[s]).getTime()?t[s]=t[s]:t[s]=Object(n["cloneDeep"])(this.addSeconds(t[r],1)),t[r]=Object(n["cloneDeep"])(this.addSeconds(t[s],h)),(new Date(d).getTime()<new Date(t[r]).getTime()||o<=5e3)&&(t[r]=d),new Date(d).getTime()<new Date(t[s]).getTime()?setTimeout((function(){a.exportObj=c({},a.exportObj,{fileName:l,sum:o,current:o,excelData:[],visible:!0})}),1500):(t.currentPage=1,this.callback(e,t,i))},addSeconds:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o()(e).add(t,"days").format("YYYY-MM-DD")},msg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";this.$message({showClose:!0,message:e,type:t,duration:3e3})}}}}}]);
//# sourceMappingURL=chunk-fb997592.aa7048c0.js.map